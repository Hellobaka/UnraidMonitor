<UserControl
    x:Class="me.cqp.luohuaming.UnraidMonitor.UI.Views.Controls.CommandDetailControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:hc="https://handyorg.github.io/handycontrol"
    xmlns:local="clr-namespace:me.cqp.luohuaming.UnraidMonitor.UI.Views.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="850"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <Grid Margin="0,5,5,5">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <TabControl>
            <!--  基础 Tab  -->
            <hc:TabItem Header="基础">
                <StackPanel Margin="10" DataContext="{Binding CurrentConfig}">
                    <CheckBox
                        Margin="0,0,0,8"
                        Content="启用"
                        IsChecked="{Binding Enabled}" />
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="命令名"
                        Text="{Binding Command, UpdateSourceTrigger=PropertyChanged}" />
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="描述"
                        Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" />
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="分类"
                        Text="{Binding Category, UpdateSourceTrigger=PropertyChanged}" />
                    <hc:NumericUpDown
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="超时(秒)"
                        Maximum="600"
                        Minimum="1"
                        Value="{Binding Timeout}" />
                    <CheckBox
                        Margin="0,0,0,8"
                        Content="异步执行"
                        IsChecked="{Binding IsAsync}" />
                    <CheckBox
                        Margin="0,0,0,8"
                        Content="需要确认"
                        IsChecked="{Binding RequireConfirmation}" />
                </StackPanel>
            </hc:TabItem>
            <!--  权限 Tab  -->
            <hc:TabItem Header="权限">
                <StackPanel Margin="10" DataContext="{Binding CurrentConfig.Permissions}">
                    <TextBlock FontWeight="Bold" Text="允许用户(ID)：" />
                    <ListBox Height="60" ItemsSource="{Binding AllowedUsers}" />
                    <StackPanel Margin="0,4,0,8" Orientation="Horizontal">
                        <TextBox
                            x:Name="UserIdInput"
                            Width="120"
                            Margin="0,0,8,0" />
                        <Button
                            Command="{Binding DataContext.AddUserCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            CommandParameter="{Binding Text, ElementName=UserIdInput}"
                            Content="添加" />
                        <Button
                            Margin="8,0,0,0"
                            Command="{Binding DataContext.RemoveUserCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Content="删除" />
                    </StackPanel>
                    <TextBlock FontWeight="Bold" Text="允许群组(ID)：" />
                    <ListBox Height="60" ItemsSource="{Binding AllowedGroups}" />
                    <StackPanel Margin="0,4,0,8" Orientation="Horizontal">
                        <TextBox
                            x:Name="GroupIdInput"
                            Width="120"
                            Margin="0,0,8,0" />
                        <Button
                            Command="{Binding DataContext.AddGroupCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            CommandParameter="{Binding Text, ElementName=GroupIdInput}"
                            Content="添加" />
                        <Button
                            Margin="8,0,0,0"
                            Command="{Binding DataContext.RemoveGroupCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Content="删除" />
                    </StackPanel>
                    <CheckBox
                        Margin="0,8,0,0"
                        Content="需要管理员权限"
                        IsChecked="{Binding RequireAdmin}" />
                    <StackPanel Margin="0,8,0,0" Orientation="Horizontal">
                        <hc:ComboBox
                            x:Name="CopyPermFromCmd"
                            Width="180"
                            DisplayMemberPath="Command"
                            ItemsSource="{Binding DataContext.CommandList, RelativeSource={RelativeSource AncestorType=Window}}"
                            SelectedValuePath="Command" />
                        <Button
                            Margin="8,0,0,0"
                            Command="{Binding DataContext.CopyPermissionFromCommandCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            CommandParameter="{Binding SelectedItem, ElementName=CopyPermFromCmd}"
                            Content="从指令复制权限" />
                    </StackPanel>
                </StackPanel>
            </hc:TabItem>
            <!--  参数 Tab  -->
            <hc:TabItem Header="参数">
                <StackPanel Margin="10" DataContext="{Binding CurrentConfig.Parameters}">
                    <CheckBox
                        Margin="0,0,0,8"
                        Content="需要参数"
                        IsChecked="{Binding HasParameters}" />
                    <StackPanel Margin="0,0,0,8" HorizontalAlignment="Left">
                        <TextBlock Margin="0,5">最小参数数</TextBlock>
                        <hc:NumericUpDown
                            Width="120"
                            Minimum="0"
                            Value="{Binding MinParameters}" />
                        <TextBlock Margin="0,5">最大参数数</TextBlock>
                        <hc:NumericUpDown
                            Width="120"
                            hc:InfoElement.Title="最大参数数"
                            Minimum="0"
                            Value="{Binding MaxParameters}" />
                    </StackPanel>
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="参数正则"
                        Text="{Binding ParameterPattern}" />
                    <TextBlock FontWeight="Bold" Text="参数校验规则：" />
                    <DataGrid
                        AutoGenerateColumns="False"
                        HeadersVisibility="All"
                        ItemsSource="{Binding ValidationRules}"
                        RowHeaderWidth="60">
                        <DataGrid.Columns>
                            <DataGridTextColumn
                                Width="60"
                                Binding="{Binding ParameterIndex}"
                                Header="索引" />
                            <DataGridTextColumn
                                Width="80"
                                Binding="{Binding ValueType}"
                                Header="类型" />
                            <DataGridCheckBoxColumn
                                Width="60"
                                Binding="{Binding IsRequired}"
                                Header="必填" />
                            <DataGridTextColumn
                                Width="*"
                                Binding="{Binding ValidationRegex}"
                                Header="正则" />
                        </DataGrid.Columns>
                    </DataGrid>
                    <StackPanel Margin="0,4,0,0" Orientation="Horizontal">
                        <Button
                            Width="80"
                            Command="{Binding DataContext.AddRuleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Content="添加规则" />
                        <Button
                            Width="80"
                            Margin="8,0,0,0"
                            Command="{Binding DataContext.RemoveRuleCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Content="删除选中" />
                    </StackPanel>
                </StackPanel>
            </hc:TabItem>
            <!--  SSH Tab  -->
            <hc:TabItem Header="SSH">
                <StackPanel Margin="10" DataContext="{Binding CurrentConfig.SshConfig}">
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="SSH命令"
                        Text="{Binding Command}" />
                    <CheckBox
                        Margin="0,0,0,8"
                        Content="使用sudo"
                        IsChecked="{Binding UseSudo}" />
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="工作目录"
                        Text="{Binding WorkingDirectory}" />
                </StackPanel>
            </hc:TabItem>
            <!--  响应 Tab  -->
            <hc:TabItem Header="响应">
                <StackPanel Margin="10" DataContext="{Binding CurrentConfig.Responses}">
                    <TextBlock FontWeight="Bold" Text="成功响应：" />
                    <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                        <hc:TextBox
                            Width="200"
                            hc:InfoElement.Title="消息"
                            Text="{Binding Success.Message}" />
                        <hc:ComboBox
                            Width="100"
                            Margin="8,0,0,0"
                            hc:InfoElement.Title="格式"
                            SelectedValue="{Binding Success.Format}">
                            <ComboBoxItem Content="text" />
                            <ComboBoxItem Content="json" />
                        </hc:ComboBox>
                        <CheckBox
                            Margin="8,0,0,0"
                            Content="包含命令输出"
                            IsChecked="{Binding Success.IncludeCommandOutput}" />
                    </StackPanel>
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="输出过滤正则"
                        Text="{Binding Success.OutputFilterRegex}" />
                    <TextBlock FontWeight="Bold" Text="失败响应：" />
                    <StackPanel Margin="0,0,0,8" Orientation="Horizontal">
                        <hc:TextBox
                            Width="200"
                            hc:InfoElement.Title="消息"
                            Text="{Binding Failure.Message}" />
                        <hc:ComboBox
                            Width="100"
                            Margin="8,0,0,0"
                            hc:InfoElement.Title="格式"
                            SelectedValue="{Binding Failure.Format}">
                            <ComboBoxItem Content="text" />
                            <ComboBoxItem Content="json" />
                        </hc:ComboBox>
                        <CheckBox
                            Margin="8,0,0,0"
                            Content="包含命令输出"
                            IsChecked="{Binding Failure.IncludeCommandOutput}" />
                    </StackPanel>
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="输出过滤正则"
                        Text="{Binding Failure.OutputFilterRegex}" />
                    <hc:TextBox
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="等待消息"
                        Text="{Binding PendingMessage}" />
                </StackPanel>
            </hc:TabItem>
            <!--  日志 Tab  -->
            <hc:TabItem Header="日志">
                <StackPanel Margin="10" DataContext="{Binding CurrentConfig.Logging}">
                    <CheckBox
                        Margin="0,0,0,8"
                        Content="启用日志"
                        IsChecked="{Binding Enabled}" />
                    <hc:ComboBox
                        Width="120"
                        Margin="0,0,0,8"
                        hc:InfoElement.Title="日志等级"
                        SelectedValue="{Binding LogLevel}">
                        <ComboBoxItem Content="Info" />
                        <ComboBoxItem Content="Warning" />
                        <ComboBoxItem Content="Error" />
                        <ComboBoxItem Content="Debug" />
                    </hc:ComboBox>
                    <CheckBox
                        Margin="0,0,0,8"
                        Content="记录参数"
                        IsChecked="{Binding LogParameters}" />
                </StackPanel>
            </hc:TabItem>
        </TabControl>
        <Button
            Grid.Row="1"
            Margin="0,5,0,0"
            HorizontalAlignment="Stretch"
            Command="{Binding SaveCurrentCommand}"
            Content="保存本指令" />
    </Grid>
</UserControl>